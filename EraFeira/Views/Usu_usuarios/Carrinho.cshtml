@model IEnumerable<EraFeira.Models.Pro_produto>
@{
    ViewBag.Title = "Carrinho";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link href="~/Content/Carrinho.css" rel="stylesheet" />

<div class="car-section">

    <aside>
        <p class="car-aside-text">Valor<br>
            <span class="car-just-color">Cesta</span>
            <span class="car-background-aside">65,50</span>
        </p>
    </aside>

    <div class="car-titulos">
        <h1 class="car-h1">Digite um nome para sua <span class="car-diferente">cesta</span></h1>
        <input class="car-input" type="text" placeholder="ex: Legumes da vovó">
    </div>
    <br />

    <div class="container">
        <div class="row justify-content-md-center">
            @foreach (var produto in Model)
            {
                <div class="col col-lg-4 spacing">
                    <div class="bloco-imagem-cinza">
                        <img class="img-fluid size-img" src="~/Uploads/@produto.Pro_foto" />
                    </div>
                    <h2 class="car-h2"> @produto.Pro_descricao</h2>
                
                    <div class="row car-setas " >
                        <div class="col-md-3 offset-2">
                            <button class="btn btn-hook-0" tipo="menos"  produtoID="10" >
                                <img class="car-seta-tamanho" src="~/Imagens/esquerda.png" @*produtoID = produto.Pro_id*@/>
                            </button>
                        </div>
                        @*<div class="col-md-2 car-quantidade">*@
                            <input class="col-md-2 car-quantidade" value="0" />
                        @*</div>*@
                        <div class=" col-md-2" >
                            <button class="btn btn-hook-0" produtoID="10" tipo="mais">
                                <img class="car-seta-tamanho" src="~/Imagens/direita.png" @*produtoID = produto.Pro_id*@ />
                            </button>
                        </div>
                    </div>

                </div>

            }
        </div>
    </div>

</div>

<script src="~/Scripts/jquery-3.3.1.min.js"></script>
<script>
   // var qtd = value;
    var cestaBase = [];
    cestaBase.push({ "produtoID": 10, "qtd": 1 });       // stack is now [2]
    cestaBase.push({ "produtoID": 20, "qtd": 1 });       // stack is now [2, 5]

    document.cookie = "ItensCesta = " + JSON.stringify(cestaBase);

    $(".btn-hook-0").click(function () {

        var cestaCookie = JSON.parse(getCookie("ItensCesta"));
        var idDoProduto = $(this).attr("produtoID");
        var posDoObj = cestaCookie.findIndex(x => x.produtoID == idDoProduto)

        if ($(this).attr("tipo") == "mais") {
            var now = $(".div > input").val();
            if ($.isNumeric(now)) {
                $(".div > input").val(parseInt(now) + 1);
            } else {
                $(".div > input").val("1");
            }
            //console.log("mais");
            //cestaCookie[posDoObj].qtd += 1;

        } else {
            if (cestaCookie[posDoObj].qtd > 0) {
                console.log("menos");
                cestaCookie[posDoObj].qtd -= 1;
            }
        }
        //console.log(cestaCookie);
        document.cookie = "ItensCesta = " + JSON.stringify(cestaCookie);
    });

    function getCookie(name) {
        var value = "; " + document.cookie;
        var parts = value.split("; " + name + "=");
        if (parts.length == 2) return parts.pop().split(";").shift();
    }


</script>